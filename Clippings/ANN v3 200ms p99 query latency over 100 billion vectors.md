---
title: "ANN v3: 200ms p99 query latency over 100 billion vectors"
source: https://turbopuffer.com/blog/ann-v3
author:
  - "[[turbopuffer]]"
published:
created: 2026-01-27
description: Our latest ANN release supports scales of 100+ billion vectors in a single search index, with 200ms p99 query latency at 1k QPS and 92% recall.
tags:
  - clippings
  - turbopuffer
---
January 21, 2026 Nathan VanBenschoten (Chief Architect)

The pursuit of scale is not vanity. When you take existing systems and optimize them from first principles to achieve a step change in scalability, you can create something entirely new.

Nothing has demonstrated that more clearly than the explosion in deep learning over the past decade. The ML community took decades-old ideas and combined them with advancements in hardware, new algorithms, and hyper-specialization to forge something remarkable.

Both inspired by the ML community and in service of it, we recently rebuilt vector search in turbopuffer to support scales of up to **100 billion vectors** in a **single search index**. We call this technology Approximate Nearest Neighbor (ANN) Search v3, [and it is available now](https://turbopuffer.com/blog/#use-now).

In this post, I'll dive into the technical details behind how we built for 100 billion vectors. Along the way, we’ll examine turbopuffer’s architecture, travel up the modern memory hierarchy, zoom into a single CPU core, and then back out to the scale of a distributed cluster.

### ANN v3 query latency, 100B vectors, unfiltered, 1024D, k=10, 92% recall

<svg xmlns="http://www.w3.org/2000/svg" class="recharts-surface" width="739" height="400" viewBox="0 0 739 400" style="width: 100%; height: 100%;"><defs><clipPath id="recharts31-clip"><rect x="60" y="20" height="320" width="679"></rect></clipPath></defs><g class="recharts-cartesian-grid"><g class="recharts-cartesian-grid-horizontal"><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="340" x2="739" y2="340"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="286.6666666666667" x2="739" y2="286.6666666666667"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="233.33333333333334" x2="739" y2="233.33333333333334"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="180" x2="739" y2="180"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="126.66666666666667" x2="739" y2="126.66666666666667"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="73.33333333333333" x2="739" y2="73.33333333333333"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="60" y1="20" x2="739" y2="20"></line></g><g class="recharts-cartesian-grid-vertical"><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="86.11538461538461" y1="20" x2="86.11538461538461" y2="340"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="242.80769230769232" y1="20" x2="242.80769230769232" y2="340"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="399.5" y1="20" x2="399.5" y2="340"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="556.1923076923076" y1="20" x2="556.1923076923076" y2="340"></line><line class="stroke-slate-700 stroke-1" stroke="#ccc" fill="none" x="60" y="20" width="679" height="320" x1="712.8846153846154" y1="20" x2="712.8846153846154" y2="340"></line></g></g><g class="recharts-layer recharts-cartesian-axis recharts-xAxis xAxis text-xs"><line orientation="bottom" width="679" height="50" fill="none" stroke="#ffffff" class="recharts-cartesian-axis-line" x="60" y="340" stroke-opacity="0.6" x1="60" y1="340" x2="739" y2="340"></line><g class="recharts-cartesian-axis-ticks"><g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="bottom" width="679" height="50" stroke="none" transform="translate(0, 6)" font-size="12" x="86.11538461538461" y="348" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle" fill="#cbd5e1"><tspan x="86.11538461538461" dy="0.71em">07:00</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="bottom" width="679" height="50" stroke="none" transform="translate(0, 6)" font-size="12" x="242.80769230769232" y="348" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle" fill="#cbd5e1"><tspan x="242.80769230769232" dy="0.71em">08:00</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="bottom" width="679" height="50" stroke="none" transform="translate(0, 6)" font-size="12" x="399.5" y="348" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle" fill="#cbd5e1"><tspan x="399.5" dy="0.71em">09:00</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="bottom" width="679" height="50" stroke="none" transform="translate(0, 6)" font-size="12" x="556.1923076923076" y="348" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle" fill="#cbd5e1"><tspan x="556.1923076923076" dy="0.71em">10:00</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="bottom" width="679" height="50" stroke="none" transform="translate(0, 6)" font-size="12" x="712.8846153846154" y="348" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="middle" fill="#cbd5e1"><tspan x="712.8846153846154" dy="0.71em">11:00</tspan></text></g></g> <text offset="0" x="399.5" y="390" class="recharts-text fill-slate-300 text-sm font-medium" text-anchor="middle" fill="#808080"><tspan x="399.5" dy="0em">timestamp</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis recharts-yAxis yAxis text-xs"><line orientation="left" width="50" height="320" fill="none" stroke="#ffffff" class="recharts-cartesian-axis-line" x="10" y="20" stroke-opacity="0.6" x1="60" y1="20" x2="60" y2="340"></line><g class="recharts-cartesian-axis-ticks"><g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="340" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">0</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="286.6666666666667" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">50</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="233.33333333333334" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">100</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="180" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">150</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="126.66666666666667" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">200</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="73.33333333333333" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">250</tspan></text></g> <g class="recharts-layer recharts-cartesian-axis-tick"><text orientation="left" width="50" height="320" stroke="none" transform="translate(-3, 0)" font-size="12" x="52" y="20" class="recharts-text recharts-cartesian-axis-tick-value" text-anchor="end" fill="#cbd5e1"><tspan x="52" dy="0.355em">300</tspan></text></g></g> <text offset="0" transform="rotate(-90, 10, 180)" x="10" y="180" class="recharts-text fill-slate-300 text-sm font-medium" text-anchor="start" fill="#808080" style="text-anchor: middle;"><tspan x="10" dy="0.355em">latency (ms)</tspan></text></g><g class="recharts-layer recharts-line stroke-blue-500"><defs><clipPath id="clipPath-recharts-line-36"><rect x="-279.5" y="20" width="1358" height="320"></rect></clipPath></defs><path stroke="" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-opacity="1" class="recharts-curve recharts-line-curve" fill="none" width="679" height="320" clip-path="url(#clipPath-recharts-line-36)" d="M60,292.727C60.871,292.171,61.741,291.615,62.612,291.239C63.482,290.864,64.353,290.477,65.223,290.477C66.094,290.477,66.964,291.239,67.835,291.239C68.705,291.239,69.576,291.239,70.446,291.239C71.317,291.239,72.187,290.477,73.058,290.477C73.928,290.477,74.799,290.477,75.669,290.477C76.54,290.477,77.41,290.477,78.281,290.477C79.151,290.477,80.022,288.119,80.892,288.119C81.763,288.119,82.633,291.989,83.504,291.989C84.374,291.989,85.245,288.917,86.115,288.917C86.986,288.917,87.856,290.09,88.727,290.477C89.597,290.864,90.468,291.239,91.338,291.239C92.209,291.239,93.079,288.917,93.95,288.917C94.821,288.917,95.691,289.703,96.562,289.703C97.432,289.703,98.303,287.309,99.173,287.309C100.044,287.309,100.914,289.188,101.785,289.703C102.655,290.219,103.526,290.477,104.396,290.477C105.267,290.477,106.137,289.703,107.008,289.703C107.878,289.703,108.749,291.239,109.619,291.239C110.49,291.239,111.36,287.858,112.231,287.309C113.101,286.76,113.972,286.485,114.842,286.485C115.713,286.485,116.583,287.327,117.454,288.119C118.324,288.912,119.195,291.239,120.065,291.239C120.936,291.239,121.806,291.239,122.677,291.239C123.547,291.239,124.418,290.733,125.288,290.477C126.159,290.221,127.029,289.703,127.9,289.703C128.771,289.703,129.641,291.239,130.512,291.239C131.382,291.239,132.253,291.239,133.123,291.239C133.994,291.239,134.864,291.239,135.735,291.239C136.605,291.239,137.476,290.477,138.346,290.477C139.217,290.477,140.087,291.239,140.958,291.239C141.828,291.239,142.699,289.703,143.569,289.703C144.44,289.703,145.31,289.703,146.181,289.703C147.051,289.703,147.922,290.477,148.792,290.477C149.663,290.477,150.533,289.703,151.404,289.703C152.274,289.703,153.145,289.703,154.015,289.703C154.886,289.703,155.756,291.239,156.627,291.239C157.497,291.239,158.368,290.477,159.238,290.477C160.109,290.477,160.979,291.239,161.85,291.239C162.721,291.239,163.591,290.477,164.462,290.477C165.332,290.477,166.203,290.477,167.073,290.477C167.944,290.477,168.814,290.477,169.685,290.477C170.555,290.477,171.426,290.477,172.296,290.477C173.167,290.477,174.037,288.917,174.908,288.917C175.778,288.917,176.649,290.09,177.519,290.477C178.39,290.864,179.26,291.239,180.131,291.239C181.001,291.239,181.872,291.239,182.742,291.239C183.613,291.239,184.483,290.477,185.354,290.477C186.224,290.477,187.095,291.239,187.965,291.239C188.836,291.239,189.706,289.703,190.577,289.703C191.447,289.703,192.318,291.239,193.188,291.239C194.059,291.239,194.929,291.239,195.8,291.239C196.671,291.239,197.541,291.239,198.412,291.239C199.282,291.239,200.153,291.989,201.023,291.989C201.894,291.989,202.764,291.989,203.635,291.989C204.505,291.989,205.376,289.703,206.246,289.703C207.117,289.703,207.987,292.727,208.858,292.727C209.728,292.727,210.599,288.119,211.469,288.119C212.34,288.119,213.21,289.703,214.081,289.703C214.951,289.703,215.822,289.703,216.692,289.703C217.563,289.703,218.433,291.239,219.304,291.239C220.174,291.239,221.045,289.703,221.915,289.703C222.786,289.703,223.656,289.703,224.527,289.703C225.397,289.703,226.268,289.703,227.138,289.703C228.009,289.703,228.879,290.477,229.75,290.477C230.621,290.477,231.491,289.703,232.362,289.703C233.232,289.703,234.103,289.703,234.973,289.703C235.844,289.703,236.714,292.242,237.585,292.727C238.455,293.212,239.326,293.455,240.196,293.455C241.067,293.455,241.937,288.917,242.808,288.917C243.678,288.917,244.549,290.74,245.419,291.239C246.29,291.739,247.16,291.989,248.031,291.989C248.901,291.989,249.772,291.239,250.642,291.239C251.513,291.239,252.383,291.989,253.254,291.989C254.124,291.989,254.995,291.989,255.865,291.989C256.736,291.989,257.606,289.703,258.477,289.703C259.347,289.703,260.218,291.239,261.088,291.239C261.959,291.239,262.829,289.703,263.7,289.703C264.571,289.703,265.441,290.477,266.312,290.477C267.182,290.477,268.053,288.119,268.923,288.119C269.794,288.119,270.664,289.703,271.535,289.703C272.405,289.703,273.276,289.703,274.146,289.703C275.017,289.703,275.887,291.239,276.758,291.239C277.628,291.239,278.499,291.239,279.369,291.239C280.24,291.239,281.11,291.239,281.981,291.239C282.851,291.239,283.722,289.703,284.592,289.703C285.463,289.703,286.333,290.477,287.204,290.477C288.074,290.477,288.945,289.703,289.815,289.703C290.686,289.703,291.556,290.477,292.427,290.477C293.297,290.477,294.168,290.477,295.038,290.477C295.909,290.477,296.779,290.477,297.65,290.477C298.521,290.477,299.391,288.119,300.262,288.119C301.132,288.119,302.003,288.917,302.873,288.917C303.744,288.917,304.614,288.917,305.485,288.917C306.355,288.917,307.226,290.09,308.096,290.477C308.967,290.864,309.837,291.239,310.708,291.239C311.578,291.239,312.449,291.239,313.319,291.239C314.19,291.239,315.06,291.239,315.931,291.239C316.801,291.239,317.672,289.703,318.542,289.703C319.413,289.703,320.283,289.703,321.154,289.703C322.024,289.703,322.895,289.703,323.765,289.703C324.636,289.703,325.506,288.917,326.377,288.917C327.247,288.917,328.118,291.989,328.988,291.989C329.859,291.989,330.729,290.477,331.6,290.477C332.471,290.477,333.341,291.239,334.212,291.239C335.082,291.239,335.953,291.239,336.823,291.239C337.694,291.239,338.564,290.477,339.435,290.477C340.305,290.477,341.176,291.989,342.046,291.989C342.917,291.989,343.787,291.62,344.658,291.239C345.528,290.858,346.399,289.703,347.269,289.703C348.14,289.703,349.01,291.239,349.881,291.239C350.751,291.239,351.622,290.477,352.492,290.477C353.363,290.477,354.233,290.987,355.104,291.239C355.974,291.492,356.845,291.989,357.715,291.989C358.586,291.989,359.456,291.239,360.327,291.239C361.197,291.239,362.068,291.239,362.938,291.239C363.809,291.239,364.679,291.239,365.55,291.239C366.421,291.239,367.291,291.239,368.162,291.239C369.032,291.239,369.903,291.989,370.773,291.989C371.644,291.989,372.514,290.477,373.385,290.477C374.255,290.477,375.126,290.477,375.996,290.477C376.867,290.477,377.737,289.703,378.608,289.703C379.478,289.703,380.349,291.989,381.219,291.989C382.09,291.989,382.96,288.119,383.831,288.119C384.701,288.119,385.572,290.477,386.442,290.477C387.313,290.477,388.183,290.477,389.054,290.477C389.924,290.477,390.795,291.239,391.665,291.239C392.536,291.239,393.406,291.239,394.277,291.239C395.147,291.239,396.018,288.917,396.888,288.917C397.759,288.917,398.629,289.703,399.5,289.703C400.371,289.703,401.241,289.703,402.112,289.703C402.982,289.703,403.853,291.989,404.723,291.989C405.594,291.989,406.464,291.739,407.335,291.239C408.205,290.74,409.076,288.917,409.946,288.917C410.817,288.917,411.687,288.917,412.558,288.917C413.428,288.917,414.299,291.239,415.169,291.239C416.04,291.239,416.91,290.733,417.781,290.477C418.651,290.221,419.522,289.703,420.392,289.703C421.263,289.703,422.133,289.703,423.004,289.703C423.874,289.703,424.745,289.703,425.615,289.703C426.486,289.703,427.356,291.239,428.227,291.239C429.097,291.239,429.968,290.477,430.838,290.477C431.709,290.477,432.579,292.727,433.45,292.727C434.321,292.727,435.191,290.477,436.062,290.477C436.932,290.477,437.803,291.239,438.673,291.239C439.544,291.239,440.414,290.477,441.285,290.477C442.155,290.477,443.026,291.239,443.896,291.239C444.767,291.239,445.637,290.733,446.508,290.477C447.378,290.221,448.249,289.703,449.119,289.703C449.99,289.703,450.86,291.239,451.731,291.239C452.601,291.239,453.472,288.917,454.342,288.917C455.213,288.917,456.083,291.239,456.954,291.239C457.824,291.239,458.695,291.239,459.565,291.239C460.436,291.239,461.306,291.989,462.177,291.989C463.047,291.989,463.918,291.239,464.788,291.239C465.659,291.239,466.529,292.727,467.4,292.727C468.271,292.727,469.141,292.364,470.012,291.989C470.882,291.614,471.753,290.477,472.623,290.477C473.494,290.477,474.364,292.727,475.235,292.727C476.105,292.727,476.976,292.727,477.846,292.727C478.717,292.727,479.587,290.477,480.458,290.477C481.328,290.477,482.199,290.477,483.069,290.477C483.94,290.477,484.81,289.703,485.681,289.703C486.551,289.703,487.422,291.239,488.292,291.239C489.163,291.239,490.033,288.119,490.904,288.119C491.774,288.119,492.645,288.524,493.515,288.917C494.386,289.31,495.256,290.477,496.127,290.477C496.997,290.477,497.868,288.119,498.738,288.119C499.609,288.119,500.479,288.917,501.35,288.917C502.221,288.917,503.091,288.388,503.962,288.119C504.832,287.851,505.703,287.849,506.573,287.309C507.444,286.768,508.314,283.937,509.185,283.937C510.055,283.937,510.926,287.158,511.796,288.119C512.667,289.081,513.537,289.183,514.408,289.703C515.278,290.223,516.149,291.239,517.019,291.239C517.89,291.239,518.76,288.917,519.631,288.917C520.501,288.917,521.372,291.239,522.242,291.239C523.113,291.239,523.983,290.09,524.854,289.703C525.724,289.316,526.595,288.917,527.465,288.917C528.336,288.917,529.206,290.477,530.077,290.477C530.947,290.477,531.818,290.477,532.688,290.477C533.559,290.477,534.429,288.917,535.3,288.917C536.171,288.917,537.041,290.477,537.912,290.477C538.782,290.477,539.653,290.477,540.523,290.477C541.394,290.477,542.264,291.614,543.135,291.989C544.005,292.364,544.876,292.727,545.746,292.727C546.617,292.727,547.487,292.727,548.358,292.727C549.228,292.727,550.099,291.239,550.969,291.239C551.84,291.239,552.71,291.239,553.581,291.239C554.451,291.239,555.322,291.239,556.192,291.239C557.063,291.239,557.933,291.239,558.804,291.239C559.674,291.239,560.545,292.727,561.415,292.727C562.286,292.727,563.156,291.989,564.027,291.989C564.897,291.989,565.768,292.483,566.638,292.727C567.509,292.972,568.379,293.455,569.25,293.455C570.121,293.455,570.991,291.239,571.862,291.239C572.732,291.239,573.603,294.171,574.473,294.171C575.344,294.171,576.214,293.455,577.085,293.455C577.955,293.455,578.826,293.455,579.696,293.455C580.567,293.455,581.437,289.703,582.308,289.703C583.178,289.703,584.049,290.477,584.919,290.477C585.79,290.477,586.66,289.703,587.531,289.703C588.401,289.703,589.272,290.477,590.142,290.477C591.013,290.477,591.883,289.703,592.754,289.703C593.624,289.703,594.495,291.239,595.365,291.239C596.236,291.239,597.106,291.239,597.977,291.239C598.847,291.239,599.718,291.989,600.588,291.989C601.459,291.989,602.329,288.119,603.2,288.119C604.071,288.119,604.941,290.471,605.812,291.239C606.682,292.007,607.553,292.727,608.423,292.727C609.294,292.727,610.164,291.615,611.035,291.239C611.905,290.864,612.776,290.477,613.646,290.477C614.517,290.477,615.387,293.455,616.258,293.455C617.128,293.455,617.999,291.989,618.869,291.989C619.74,291.989,620.61,291.989,621.481,291.989C622.351,291.989,623.222,288.917,624.092,288.917C624.963,288.917,625.833,292.727,626.704,292.727C627.574,292.727,628.445,291.239,629.315,291.239C630.186,291.239,631.056,293.455,631.927,293.455C632.797,293.455,633.668,291.865,634.538,291.239C635.409,290.614,636.279,289.703,637.15,289.703C638.021,289.703,638.891,292.727,639.762,292.727C640.632,292.727,641.503,291.239,642.373,291.239C643.244,291.239,644.114,291.239,644.985,291.239C645.855,291.239,646.726,292.727,647.596,292.727C648.467,292.727,649.337,292.364,650.208,291.989C651.078,291.614,651.949,290.477,652.819,290.477C653.69,290.477,654.56,292.112,655.431,292.727C656.301,293.343,657.172,294.171,658.042,294.171C658.913,294.171,659.783,293.818,660.654,293.455C661.524,293.091,662.395,292.486,663.265,291.989C664.136,291.493,665.006,290.477,665.877,290.477C666.747,290.477,667.618,294.171,668.488,294.171C669.359,294.171,670.229,291.239,671.1,291.239C671.971,291.239,672.841,291.239,673.712,291.239C674.582,291.239,675.453,291.989,676.323,291.989C677.194,291.989,678.064,288.917,678.935,288.917C679.805,288.917,680.676,290.483,681.546,291.239C682.417,291.996,683.287,293.455,684.158,293.455C685.028,293.455,685.899,293.455,686.769,293.455C687.64,293.455,688.51,293.455,689.381,293.455C690.251,293.455,691.122,291.239,691.992,291.239C692.863,291.239,693.733,292.727,694.604,292.727C695.474,292.727,696.345,292.727,697.215,292.727C698.086,292.727,698.956,293.455,699.827,293.455C700.697,293.455,701.568,292.727,702.438,292.727C703.309,292.727,704.179,292.727,705.05,292.727C705.921,292.727,706.791,291.874,707.662,291.239C708.532,290.604,709.403,288.917,710.273,288.917C711.144,288.917,712.014,289.965,712.885,290.477C713.755,290.989,714.626,291.989,715.496,291.989C716.367,291.989,717.237,290.477,718.108,290.477C718.978,290.477,719.849,291.989,720.719,291.989C721.59,291.989,722.46,290.477,723.331,290.477C724.201,290.477,725.072,291.989,725.942,291.989C726.813,291.989,727.683,290.477,728.554,290.477C729.424,290.477,730.295,292.727,731.165,292.727C732.036,292.727,732.906,291.989,733.777,291.989C734.647,291.989,735.518,294.171,736.388,294.171C737.259,294.171,738.129,293.449,739,292.727" style="opacity: 1;"></path><g class="recharts-layer" clip-path="url(#clipPath-recharts-line-36)"></g></g><g class="recharts-layer recharts-line stroke-cyan-500"><defs><clipPath id="clipPath-recharts-line-37"><rect x="-279.5" y="20" width="1358" height="320"></rect></clipPath></defs><path stroke="" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-opacity="1" class="recharts-curve recharts-line-curve" fill="none" width="679" height="320" clip-path="url(#clipPath-recharts-line-37)" d="M60,279.419C60.871,276.977,61.741,274.535,62.612,274.535C63.482,274.535,64.353,275.542,65.223,275.542C66.094,275.542,66.964,275.542,67.835,275.542C68.705,275.542,69.576,271.578,70.446,270.347C71.317,269.115,72.187,268.154,73.058,268.154C73.928,268.154,74.799,271.419,75.669,271.419C76.54,271.419,77.41,269.268,78.281,268.154C79.151,267.039,80.022,264.733,80.892,264.733C81.763,264.733,82.633,275.542,83.504,275.542C84.374,275.542,85.245,265.89,86.115,265.89C86.986,265.89,87.856,280.351,88.727,280.351C89.597,280.351,90.468,279.404,91.338,277.51C92.209,275.617,93.079,268.154,93.95,268.154C94.821,268.154,95.691,272.474,96.562,272.474C97.432,272.474,98.303,259.917,99.173,259.917C100.044,259.917,100.914,270.347,101.785,270.347C102.655,270.347,103.526,270.347,104.396,270.347C105.267,270.347,106.137,269.259,107.008,269.259C107.878,269.259,108.749,275.542,109.619,275.542C110.49,275.542,111.36,264.826,112.231,262.362C113.101,259.898,113.972,258.666,114.842,258.666C115.713,258.666,116.583,259.493,117.454,261.149C118.324,262.804,119.195,274.535,120.065,274.535C120.936,274.535,121.806,272.474,122.677,272.474C123.547,272.474,124.418,275.542,125.288,275.542C126.159,275.542,127.029,269.259,127.9,269.259C128.771,269.259,129.641,269.259,130.512,269.259C131.382,269.259,132.253,273.864,133.123,274.535C133.994,275.207,134.864,275.542,135.735,275.542C136.605,275.542,137.476,270.347,138.346,270.347C139.217,270.347,140.087,274.535,140.958,274.535C141.828,274.535,142.699,269.259,143.569,269.259C144.44,269.259,145.31,274.535,146.181,274.535C147.051,274.535,147.922,268.154,148.792,268.154C149.663,268.154,150.533,271.419,151.404,271.419C152.274,271.419,153.145,269.259,154.015,269.259C154.886,269.259,155.756,274.535,156.627,274.535C157.497,274.535,158.368,272.474,159.238,272.474C160.109,272.474,160.979,272.474,161.85,272.474C162.721,272.474,163.591,272.474,164.462,272.474C165.332,272.474,166.203,275.542,167.073,275.542C167.944,275.542,168.814,270.347,169.685,270.347C170.555,270.347,171.426,272.474,172.296,272.474C173.167,272.474,174.037,265.89,174.908,265.89C175.778,265.89,176.649,271.416,177.519,273.513C178.39,275.609,179.26,278.471,180.131,278.471C181.001,278.471,181.872,277.534,182.742,276.534C183.613,275.535,184.483,272.474,185.354,272.474C186.224,272.474,187.095,275.542,187.965,275.542C188.836,275.542,189.706,272.474,190.577,272.474C191.447,272.474,192.318,272.474,193.188,272.474C194.059,272.474,194.929,276.534,195.8,276.534C196.671,276.534,197.541,271.419,198.412,271.419C199.282,271.419,200.153,277.51,201.023,277.51C201.894,277.51,202.764,277.51,203.635,277.51C204.505,277.51,205.376,273.513,206.246,273.513C207.117,273.513,207.987,280.351,208.858,280.351C209.728,280.351,210.599,267.03,211.469,267.03C212.34,267.03,213.21,273.513,214.081,273.513C214.951,273.513,215.822,270.347,216.692,270.347C217.563,270.347,218.433,272.474,219.304,272.474C220.174,272.474,221.045,272.122,221.915,271.419C222.786,270.715,223.656,246.486,224.527,246.486C225.397,246.486,226.268,271.781,227.138,272.474C228.009,273.166,228.879,273.513,229.75,273.513C230.621,273.513,231.491,271.419,232.362,271.419C233.232,271.419,234.103,272.117,234.973,273.513C235.844,274.908,236.714,281.579,237.585,282.172C238.455,282.765,239.326,283.061,240.196,283.061C241.067,283.061,241.937,271.419,242.808,271.419C243.678,271.419,244.549,276.022,245.419,277.51C246.29,278.999,247.16,280.351,248.031,280.351C248.901,280.351,249.772,274.535,250.642,274.535C251.513,274.535,252.383,279.419,253.254,279.419C254.124,279.419,254.995,278.783,255.865,277.51C256.736,276.238,257.606,270.347,258.477,270.347C259.347,270.347,260.218,275.542,261.088,275.542C261.959,275.542,262.829,272.474,263.7,272.474C264.571,272.474,265.441,273.513,266.312,273.513C267.182,273.513,268.053,257.395,268.923,257.395C269.794,257.395,270.664,269.341,271.535,271.419C272.405,273.497,273.276,274.535,274.146,274.535C275.017,274.535,275.887,273.856,276.758,273.513C277.628,273.169,278.499,272.474,279.369,272.474C280.24,272.474,281.11,274.535,281.981,274.535C282.851,274.535,283.722,272.993,284.592,272.474C285.463,271.954,286.333,271.419,287.204,271.419C288.074,271.419,288.945,272.474,289.815,272.474C290.686,272.474,291.556,264.733,292.427,264.733C293.297,264.733,294.168,272.474,295.038,272.474C295.909,272.474,296.779,268.321,297.65,267.03C298.521,265.74,299.391,264.733,300.262,264.733C301.132,264.733,302.003,267.039,302.873,268.154C303.744,269.268,304.614,270.355,305.485,271.419C306.355,272.482,307.226,273.683,308.096,274.535C308.967,275.388,309.837,276.534,310.708,276.534C311.578,276.534,312.449,274.535,313.319,274.535C314.19,274.535,315.06,276.534,315.931,276.534C316.801,276.534,317.672,265.89,318.542,265.89C319.413,265.89,320.283,272.474,321.154,272.474C322.024,272.474,322.895,268.154,323.765,268.154C324.636,268.154,325.506,274.23,326.377,275.542C327.247,276.854,328.118,277.51,328.988,277.51C329.859,277.51,330.729,268.154,331.6,268.154C332.471,268.154,333.341,272.116,334.212,273.513C335.082,274.909,335.953,276.534,336.823,276.534C337.694,276.534,338.564,274.535,339.435,274.535C340.305,274.535,341.176,278.471,342.046,278.471C342.917,278.471,343.787,275.89,344.658,274.535C345.528,273.181,346.399,270.347,347.269,270.347C348.14,270.347,349.01,274.535,349.881,274.535C350.751,274.535,351.622,274.535,352.492,274.535C353.363,274.535,354.233,274.535,355.104,274.535C355.974,274.535,356.845,276.87,357.715,277.51C358.586,278.151,359.456,278.471,360.327,278.471C361.197,278.471,362.068,276.534,362.938,276.534C363.809,276.534,364.679,279.419,365.55,279.419C366.421,279.419,367.291,276.534,368.162,276.534C369.032,276.534,369.903,277.51,370.773,277.51C371.644,277.51,372.514,273.513,373.385,273.513C374.255,273.513,375.126,275.542,375.996,275.542C376.867,275.542,377.737,270.347,378.608,270.347C379.478,270.347,380.349,278.471,381.219,278.471C382.09,278.471,382.96,264.733,383.831,264.733C384.701,264.733,385.572,274.535,386.442,274.535C387.313,274.535,388.183,270.347,389.054,270.347C389.924,270.347,390.795,273.864,391.665,274.535C392.536,275.207,393.406,275.542,394.277,275.542C395.147,275.542,396.018,259.917,396.888,259.917C397.759,259.917,398.629,261.29,399.5,263.556C400.371,265.822,401.241,270.713,402.112,273.513C402.982,276.312,403.853,280.351,404.723,280.351C405.594,280.351,406.464,278.383,407.335,276.534C408.205,274.686,409.076,269.259,409.946,269.259C410.817,269.259,411.687,269.987,412.558,270.347C413.428,270.707,414.299,270.704,415.169,271.419C416.04,272.133,416.91,275.542,417.781,275.542C418.651,275.542,419.522,273.161,420.392,272.474C421.263,271.786,422.133,271.419,423.004,271.419C423.874,271.419,424.745,274.527,425.615,275.542C426.486,276.558,427.356,277.51,428.227,277.51C429.097,277.51,429.968,276.534,430.838,276.534C431.709,276.534,432.579,281.268,433.45,281.268C434.321,281.268,435.191,269.259,436.062,269.259C436.932,269.259,437.803,276.534,438.673,276.534C439.544,276.534,440.414,272.474,441.285,272.474C442.155,272.474,443.026,277.51,443.896,277.51C444.767,277.51,445.637,271.419,446.508,271.419C447.378,271.419,448.249,271.419,449.119,271.419C449.99,271.419,450.86,273.513,451.731,273.513C452.601,273.513,453.472,267.03,454.342,267.03C455.213,267.03,456.083,276.534,456.954,276.534C457.824,276.534,458.695,275.542,459.565,275.542C460.436,275.542,461.306,277.84,462.177,278.471C463.047,279.103,463.918,278.802,464.788,279.419C465.659,280.035,466.529,282.172,467.4,282.172C468.271,282.172,469.141,279.915,470.012,278.471C470.882,277.028,471.753,273.513,472.623,273.513C473.494,273.513,474.364,278.471,475.235,278.471C476.105,278.471,476.976,278.471,477.846,278.471C478.717,278.471,479.587,273.177,480.458,272.474C481.328,271.77,482.199,271.773,483.069,271.419C483.94,271.064,484.81,270.347,485.681,270.347C486.551,270.347,487.422,272.474,488.292,272.474C489.163,272.474,490.033,267.03,490.904,267.03C491.774,267.03,492.645,267.03,493.515,267.03C494.386,267.03,495.256,269.632,496.127,270.347C496.997,271.061,497.868,270.891,498.738,271.419C499.609,271.946,500.479,273.513,501.35,273.513C502.221,273.513,503.091,262.362,503.962,262.362C504.832,262.362,505.703,262.362,506.573,262.362C507.444,262.362,508.314,261.149,509.185,261.149C510.055,261.149,510.926,264.003,511.796,265.89C512.667,267.778,513.537,270.377,514.408,272.474C515.278,274.57,516.149,278.471,517.019,278.471C517.89,278.471,518.76,265.89,519.631,265.89C520.501,265.89,521.372,275.542,522.242,275.542C523.113,275.542,523.983,274.866,524.854,273.513C525.724,272.159,526.595,267.03,527.465,267.03C528.336,267.03,529.206,276.534,530.077,276.534C530.947,276.534,531.818,275.868,532.688,274.535C533.559,273.203,534.429,264.733,535.3,264.733C536.171,264.733,537.041,273.513,537.912,273.513C538.782,273.513,539.653,270.347,540.523,270.347C541.394,270.347,542.264,280.351,543.135,280.351C544.005,280.351,544.876,276.534,545.746,276.534C546.617,276.534,547.487,278.471,548.358,278.471C549.228,278.471,550.099,275.542,550.969,275.542C551.84,275.542,552.71,277.51,553.581,277.51C554.451,277.51,555.322,277.185,556.192,276.534C557.063,275.884,557.933,271.419,558.804,271.419C559.674,271.419,560.545,279.419,561.415,279.419C562.286,279.419,563.156,277.51,564.027,277.51C564.897,277.51,565.768,279.419,566.638,279.419C567.509,279.419,568.379,279.103,569.25,278.471C570.121,277.84,570.991,272.474,571.862,272.474C572.732,272.474,573.603,282.172,574.473,282.172C575.344,282.172,576.214,281.128,577.085,280.351C577.955,279.574,578.826,279.404,579.696,277.51C580.567,275.617,581.437,263.556,582.308,263.556C583.178,263.556,584.049,274.535,584.919,274.535C585.79,274.535,586.66,271.419,587.531,271.419C588.401,271.419,589.272,272.474,590.142,272.474C591.013,272.474,591.883,271.419,592.754,271.419C593.624,271.419,594.495,278.471,595.365,278.471C596.236,278.471,597.106,263.556,597.977,263.556C598.847,263.556,599.718,276.534,600.588,276.534C601.459,276.534,602.329,268.154,603.2,268.154C604.071,268.154,604.941,275.987,605.812,278.471C606.682,280.956,607.553,283.061,608.423,283.061C609.294,283.061,610.164,275.217,611.035,274.535C611.905,273.854,612.776,273.513,613.646,273.513C614.517,273.513,615.387,281.268,616.258,281.268C617.128,281.268,617.999,275.542,618.869,275.542C619.74,275.542,620.61,276.534,621.481,276.534C622.351,276.534,623.222,270.347,624.092,270.347C624.963,270.347,625.833,278.471,626.704,278.471C627.574,278.471,628.445,272.474,629.315,272.474C630.186,272.474,631.056,279.419,631.927,279.419C632.797,279.419,633.668,278.783,634.538,277.51C635.409,276.238,636.279,268.154,637.15,268.154C638.021,268.154,638.891,280.351,639.762,280.351C640.632,280.351,641.503,275.217,642.373,274.535C643.244,273.854,644.114,273.513,644.985,273.513C645.855,273.513,646.726,280.351,647.596,280.351C648.467,280.351,649.337,263.556,650.208,263.556C651.078,263.556,651.949,270.262,652.819,273.513C653.69,276.763,654.56,281.902,655.431,283.061C656.301,284.22,657.172,284.8,658.042,284.8C658.913,284.8,659.783,283.226,660.654,282.172C661.524,281.117,662.395,280.938,663.265,278.471C664.136,276.005,665.006,267.03,665.877,267.03C666.747,267.03,667.618,283.061,668.488,283.061C669.359,283.061,670.229,273.513,671.1,273.513C671.971,273.513,672.841,274.197,673.712,274.535C674.582,274.874,675.453,275.542,676.323,275.542C677.194,275.542,678.064,265.89,678.935,265.89C679.805,265.89,680.676,265.89,681.546,265.89C682.417,265.89,683.287,277.84,684.158,278.471C685.028,279.103,685.899,278.802,686.769,279.419C687.64,280.035,688.51,282.172,689.381,282.172C690.251,282.172,691.122,274.535,691.992,274.535C692.863,274.535,693.733,281.268,694.604,281.268C695.474,281.268,696.345,281.268,697.215,281.268C698.086,281.268,698.956,282.172,699.827,282.172C700.697,282.172,701.568,280.351,702.438,280.351C703.309,280.351,704.179,285.649,705.05,285.649C705.921,285.649,706.791,279.828,707.662,276.534C708.532,273.241,709.403,265.89,710.273,265.89C711.144,265.89,712.014,276.238,712.885,277.51C713.755,278.783,714.626,279.419,715.496,279.419C716.367,279.419,717.237,277.51,718.108,277.51C718.978,277.51,719.849,277.51,720.719,277.51C721.59,277.51,722.46,274.535,723.331,274.535C724.201,274.535,725.072,276.534,725.942,276.534C726.813,276.534,727.683,265.89,728.554,265.89C729.424,265.89,730.295,274.881,731.165,275.542C732.036,276.204,732.906,275.873,733.777,276.534C734.647,277.196,735.518,282.172,736.388,282.172C737.259,282.172,738.129,281.261,739,280.351" style="opacity: 1;"></path><g class="recharts-layer" clip-path="url(#clipPath-recharts-line-37)"></g></g><g class="recharts-layer recharts-line stroke-emerald-500"><defs><clipPath id="clipPath-recharts-line-38"><rect x="-279.5" y="20" width="1358" height="320"></rect></clipPath></defs><path stroke="" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-opacity="1" class="recharts-curve recharts-line-curve" fill="none" width="679" height="320" clip-path="url(#clipPath-recharts-line-38)" d="M60,212.491C60.871,210.483,61.741,208.475,62.612,208.475C63.482,208.475,64.353,216.384,65.223,216.384C66.094,216.384,66.964,214.151,67.835,212.491C68.705,210.83,69.576,207.779,70.446,206.419C71.317,205.06,72.187,205.393,73.058,204.333C73.928,203.273,74.799,200.06,75.669,200.06C76.54,200.06,77.41,206.419,78.281,206.419C79.151,206.419,80.022,197.873,80.892,197.873C81.763,197.873,82.633,212.491,83.504,212.491C84.374,212.491,85.245,206.419,86.115,206.419C86.986,206.419,87.856,235.766,88.727,235.766C89.597,235.766,90.468,220.322,91.338,212.491C92.209,204.66,93.079,188.78,93.95,188.78C94.821,188.78,95.691,204.333,96.562,204.333C97.432,204.333,98.303,179.105,99.173,179.105C100.044,179.105,100.914,193.668,101.785,197.873C102.655,202.078,103.526,204.333,104.396,204.333C105.267,204.333,106.137,195.652,107.008,195.652C107.878,195.652,108.749,216.384,109.619,216.384C110.49,216.384,111.36,198.683,112.231,195.652C113.101,192.622,113.972,192.252,114.842,191.106C115.713,189.961,116.583,188.78,117.454,188.78C118.324,188.78,119.195,198.593,120.065,202.212C120.936,205.832,121.806,206.897,122.677,210.498C123.547,214.099,124.418,223.818,125.288,223.818C126.159,223.818,127.029,200.857,127.9,197.873C128.771,194.889,129.641,193.397,130.512,193.397C131.382,193.397,132.253,204.333,133.123,204.333C133.994,204.333,134.864,203.626,135.735,202.212C136.605,200.799,137.476,186.417,138.346,186.417C139.217,186.417,140.087,216.384,140.958,216.384C141.828,216.384,142.699,204.333,143.569,204.333C144.44,204.333,145.31,216.384,146.181,216.384C147.051,216.384,147.922,209.874,148.792,206.419C149.663,202.964,150.533,195.652,151.404,195.652C152.274,195.652,153.145,206.726,154.015,210.498C154.886,214.27,155.756,218.286,156.627,218.286C157.497,218.286,158.368,195.652,159.238,195.652C160.109,195.652,160.979,222.002,161.85,222.002C162.721,222.002,163.591,218.981,164.462,216.384C165.332,213.787,166.203,206.419,167.073,206.419C167.944,206.419,168.814,206.419,169.685,206.419C170.555,206.419,171.426,222.002,172.296,222.002C173.167,222.002,174.037,195.652,174.908,195.652C175.778,195.652,176.649,223.818,177.519,223.818C178.39,223.818,179.26,216.384,180.131,216.384C181.001,216.384,181.872,217.657,182.742,218.286C183.613,218.915,184.483,220.158,185.354,220.158C186.224,220.158,187.095,217.09,187.965,214.452C188.836,211.815,189.706,204.333,190.577,204.333C191.447,204.333,192.318,207.115,193.188,208.475C194.059,209.834,194.929,212.491,195.8,212.491C196.671,212.491,197.541,200.06,198.412,200.06C199.282,200.06,200.153,227.364,201.023,227.364C201.894,227.364,202.764,226.778,203.635,225.604C204.505,224.431,205.376,214.452,206.246,214.452C207.117,214.452,207.987,223.818,208.858,223.818C209.728,223.818,210.599,206.419,211.469,206.419C212.34,206.419,213.21,214.795,214.081,218.286C214.951,221.777,215.822,227.364,216.692,227.364C217.563,227.364,218.433,215.982,219.304,212.491C220.174,209,221.045,209.226,221.915,206.419C222.786,203.613,223.656,195.652,224.527,195.652C225.397,195.652,226.268,202.964,227.138,206.419C228.009,209.874,228.879,216.384,229.75,216.384C230.621,216.384,231.491,211.195,232.362,208.475C233.232,205.754,234.103,200.06,234.973,200.06C235.844,200.06,236.714,247.157,237.585,250.736C238.455,254.315,239.326,256.105,240.196,256.105C241.067,256.105,241.937,204.333,242.808,204.333C243.678,204.333,244.549,225.604,245.419,225.604C246.29,225.604,247.16,225.604,248.031,225.604C248.901,225.604,249.772,234.138,250.642,234.138C251.513,234.138,252.383,232.826,253.254,230.803C254.124,228.781,254.995,227.87,255.865,222.002C256.736,216.135,257.606,191.106,258.477,191.106C259.347,191.106,260.218,196.415,261.088,197.873C261.959,199.331,262.829,200.06,263.7,200.06C264.571,200.06,265.441,195.652,266.312,195.652C267.182,195.652,268.053,197.873,268.923,197.873C269.794,197.873,270.664,193.397,271.535,193.397C272.405,193.397,273.276,211.016,274.146,216.384C275.017,221.752,275.887,225.604,276.758,225.604C277.628,225.604,278.499,212.557,279.369,206.419C280.24,200.282,281.11,188.78,281.981,188.78C282.851,188.78,283.722,207.126,284.592,208.475C285.463,209.824,286.333,210.498,287.204,210.498C288.074,210.498,288.945,202.212,289.815,202.212C290.686,202.212,291.556,208.475,292.427,208.475C293.297,208.475,294.168,206.419,295.038,206.419C295.909,206.419,296.779,220.158,297.65,220.158C298.521,220.158,299.391,204.333,300.262,204.333C301.132,204.333,302.003,220.158,302.873,220.158C303.744,220.158,304.614,208.475,305.485,208.475C306.355,208.475,307.226,210.498,308.096,210.498C308.967,210.498,309.837,208.475,310.708,208.475C311.578,208.475,312.449,215.116,313.319,216.384C314.19,217.652,315.06,218.286,315.931,218.286C316.801,218.286,317.672,218.286,318.542,218.286C319.413,218.286,320.283,204.208,321.154,200.06C322.024,195.912,322.895,193.397,323.765,193.397C324.636,193.397,325.506,219.007,326.377,227.364C327.247,235.722,328.118,243.541,328.988,243.541C329.859,243.541,330.729,214.452,331.6,214.452C332.471,214.452,333.341,224.431,334.212,225.604C335.082,226.778,335.953,227.364,336.823,227.364C337.694,227.364,338.564,212.491,339.435,212.491C340.305,212.491,341.176,242.034,342.046,242.034C342.917,242.034,343.787,219.808,344.658,214.452C345.528,209.097,346.399,206.419,347.269,206.419C348.14,206.419,349.01,212.491,349.881,212.491C350.751,212.491,351.622,208.475,352.492,208.475C353.363,208.475,354.233,220.158,355.104,220.158C355.974,220.158,356.845,204.333,357.715,204.333C358.586,204.333,359.456,220.158,360.327,220.158C361.197,220.158,362.068,220.158,362.938,220.158C363.809,220.158,364.679,229.098,365.55,229.098C366.421,229.098,367.291,223.818,368.162,223.818C369.032,223.818,369.903,234.138,370.773,234.138C371.644,234.138,372.514,223.253,373.385,218.286C374.255,213.318,375.126,204.333,375.996,204.333C376.867,204.333,377.737,212.127,378.608,214.452C379.478,216.778,380.349,218.286,381.219,218.286C382.09,218.286,382.96,197.873,383.831,197.873C384.701,197.873,385.572,210.498,386.442,210.498C387.313,210.498,388.183,191.106,389.054,191.106C389.924,191.106,390.795,227.364,391.665,227.364C392.536,227.364,393.406,216.329,394.277,212.491C395.147,208.652,396.018,204.333,396.888,204.333C397.759,204.333,398.629,212.491,399.5,212.491C400.371,212.491,401.241,212.491,402.112,212.491C402.982,212.491,403.853,235.766,404.723,235.766C405.594,235.766,406.464,235.223,407.335,234.138C408.205,233.052,409.076,188.78,409.946,188.78C410.817,188.78,411.687,206.353,412.558,212.491C413.428,218.628,414.299,225.604,415.169,225.604C416.04,225.604,416.91,223.222,417.781,222.002C418.651,220.782,419.522,218.286,420.392,218.286C421.263,218.286,422.133,220.158,423.004,220.158C423.874,220.158,424.745,216.384,425.615,216.384C426.486,216.384,427.356,235.766,428.227,235.766C429.097,235.766,429.968,216.384,430.838,216.384C431.709,216.384,432.579,235.766,433.45,235.766C434.321,235.766,435.191,234.177,436.062,232.483C436.932,230.79,437.803,229.268,438.673,225.604C439.544,221.94,440.414,210.498,441.285,210.498C442.155,210.498,443.026,225.604,443.896,225.604C444.767,225.604,445.637,212.491,446.508,212.491C447.378,212.491,448.249,230.803,449.119,230.803C449.99,230.803,450.86,230.235,451.731,229.098C452.601,227.961,453.472,214.452,454.342,214.452C455.213,214.452,456.083,223.818,456.954,223.818C457.824,223.818,458.695,218.286,459.565,218.286C460.436,218.286,461.306,223.818,462.177,223.818C463.047,223.818,463.918,218.286,464.788,218.286C465.659,218.286,466.529,245.025,467.4,245.025C468.271,245.025,469.141,242.143,470.012,237.37C470.882,232.596,471.753,216.384,472.623,216.384C473.494,216.384,474.364,237.37,475.235,237.37C476.105,237.37,476.976,229.926,477.846,227.364C478.717,224.803,479.587,225.577,480.458,222.002C481.328,218.427,482.199,207.182,483.069,204.333C483.94,201.484,484.81,200.06,485.681,200.06C486.551,200.06,487.422,216.384,488.292,216.384C489.163,216.384,490.033,205.105,490.904,202.212C491.774,199.319,492.645,197.873,493.515,197.873C494.386,197.873,495.256,211.897,496.127,214.452C496.997,217.008,497.868,216.725,498.738,218.286C499.609,219.847,500.479,223.818,501.35,223.818C502.221,223.818,503.091,202.212,503.962,202.212C504.832,202.212,505.703,204.874,506.573,208.475C507.444,212.076,508.314,223.818,509.185,223.818C510.055,223.818,510.926,208.475,511.796,208.475C512.667,208.475,513.537,215.431,514.408,218.286C515.278,221.141,516.149,225.604,517.019,225.604C517.89,225.604,518.76,218.286,519.631,218.286C520.501,218.286,521.372,230.803,522.242,230.803C523.113,230.803,523.983,222.698,524.854,218.286C525.724,213.874,526.595,204.333,527.465,204.333C528.336,204.333,529.206,213.868,530.077,216.384C530.947,218.9,531.818,220.158,532.688,220.158C533.559,220.158,534.429,195.652,535.3,195.652C536.171,195.652,537.041,220.158,537.912,220.158C538.782,220.158,539.653,214.452,540.523,214.452C541.394,214.452,542.264,233.133,543.135,238.948C544.005,244.763,544.876,249.342,545.746,249.342C546.617,249.342,547.487,246.906,548.358,242.034C549.228,237.162,550.099,200.06,550.969,200.06C551.84,200.06,552.71,225.072,553.581,227.364C554.451,229.657,555.322,230.803,556.192,230.803C557.063,230.803,557.933,222.002,558.804,222.002C559.674,222.002,560.545,227.465,561.415,230.803C562.286,234.142,563.156,242.034,564.027,242.034C564.897,242.034,565.768,241.524,566.638,240.503C567.509,239.483,568.379,238.924,569.25,235.766C570.121,232.608,570.991,181.58,571.862,181.58C572.732,181.58,573.603,243.541,574.473,243.541C575.344,243.541,576.214,243.039,577.085,242.034C577.955,241.029,578.826,224.528,579.696,214.452C580.567,204.377,581.437,181.58,582.308,181.58C583.178,181.58,584.049,209.17,584.919,210.498C585.79,211.826,586.66,212.491,587.531,212.491C588.401,212.491,589.272,205.624,590.142,200.06C591.013,194.495,591.883,179.105,592.754,179.105C593.624,179.105,594.495,217.272,595.365,222.002C596.236,226.732,597.106,227.075,597.977,229.098C598.847,231.12,599.718,234.138,600.588,234.138C601.459,234.138,602.329,202.212,603.2,202.212C604.071,202.212,604.941,220.781,605.812,229.098C606.682,237.414,607.553,252.11,608.423,252.11C609.294,252.11,610.164,243.324,611.035,237.37C611.905,231.415,612.776,216.384,613.646,216.384C614.517,216.384,615.387,242.034,616.258,242.034C617.128,242.034,617.999,208.475,618.869,208.475C619.74,208.475,620.61,229.098,621.481,229.098C622.351,229.098,623.222,212.491,624.092,212.491C624.963,212.491,625.833,230.803,626.704,230.803C627.574,230.803,628.445,212.491,629.315,212.491C630.186,212.491,631.056,225.604,631.927,225.604C632.797,225.604,633.668,225.009,634.538,223.818C635.409,222.626,636.279,179.105,637.15,179.105C638.021,179.105,638.891,232.483,639.762,232.483C640.632,232.483,641.503,216.384,642.373,216.384C643.244,216.384,644.114,224.134,644.985,227.364C645.855,230.595,646.726,235.766,647.596,235.766C648.467,235.766,649.337,219.529,650.208,210.498C651.078,201.467,651.949,181.58,652.819,181.58C653.69,181.58,654.56,263.556,655.431,263.556C656.301,263.556,657.172,260,658.042,257.395C658.913,254.79,659.783,250.234,660.654,247.925C661.524,245.616,662.395,246.464,663.265,243.541C664.136,240.619,665.006,202.212,665.877,202.212C666.747,202.212,667.618,252.11,668.488,252.11C669.359,252.11,670.229,212.491,671.1,212.491C671.971,212.491,672.841,212.491,673.712,212.491C674.582,212.491,675.453,212.491,676.323,212.491C677.194,212.491,678.064,213.905,678.935,216.384C679.805,218.863,680.676,220.044,681.546,227.364C682.417,234.684,683.287,261.149,684.158,261.149C685.028,261.149,685.899,257.386,686.769,256.105C687.64,254.823,688.51,255.223,689.381,253.461C690.251,251.699,691.122,238.948,691.992,238.948C692.863,238.948,693.733,252.11,694.604,252.11C695.474,252.11,696.345,242.034,697.215,242.034C698.086,242.034,698.956,258.666,699.827,258.666C700.697,258.666,701.568,235.766,702.438,235.766C703.309,235.766,704.179,272.474,705.05,272.474C705.921,272.474,706.791,256.816,707.662,246.486C708.532,236.157,709.403,210.498,710.273,210.498C711.144,210.498,712.014,225.738,712.885,229.098C713.755,232.458,714.626,234.138,715.496,234.138C716.367,234.138,717.237,225.283,718.108,222.002C718.978,218.721,719.849,214.452,720.719,214.452C721.59,214.452,722.46,222.269,723.331,227.364C724.201,232.46,725.072,245.025,725.942,245.025C726.813,245.025,727.683,202.212,728.554,202.212C729.424,202.212,730.295,230.803,731.165,230.803C732.036,230.803,732.906,216.384,733.777,216.384C734.647,216.384,735.518,234.26,736.388,237.37C737.259,240.479,738.129,241.257,739,242.034" style="opacity: 1;"></path><g class="recharts-layer" clip-path="url(#clipPath-recharts-line-38)"></g></g><g class="recharts-layer recharts-line stroke-lime-500"><defs><clipPath id="clipPath-recharts-line-39"><rect x="-279.5" y="20" width="1358" height="320"></rect></clipPath></defs><path stroke="" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-opacity="1" class="recharts-curve recharts-line-curve" fill="none" width="679" height="320" clip-path="url(#clipPath-recharts-line-39)" d="M60,123.988C60.871,124.542,61.741,125.096,62.612,127.312C63.482,129.528,64.353,155.012,65.223,155.012C66.094,155.012,66.964,155.012,67.835,155.012C68.705,155.012,69.576,153.07,70.446,149.186C71.317,145.302,72.187,119.506,73.058,117.185C73.928,114.864,74.799,113.703,75.669,113.703C76.54,113.703,77.41,140.101,78.281,140.101C79.151,140.101,80.022,127.312,80.892,127.312C81.763,127.312,82.633,136.978,83.504,136.978C84.374,136.978,85.245,127.312,86.115,127.312C86.986,127.312,87.856,179.105,88.727,179.105C89.597,179.105,90.468,163.022,91.338,152.122C92.209,141.221,93.079,113.703,93.95,113.703C94.821,113.703,95.691,127.312,96.562,127.312C97.432,127.312,98.303,99.226,99.173,99.226C100.044,99.226,100.914,127.312,101.785,127.312C102.655,127.312,103.526,125.105,104.396,123.988C105.267,122.872,106.137,120.613,107.008,120.613C107.878,120.613,108.749,155.012,109.619,155.012C110.49,155.012,111.36,130.583,112.231,130.583C113.101,130.583,113.972,136.978,114.842,136.978C115.713,136.978,116.583,127.312,117.454,127.312C118.324,127.312,119.195,138.051,120.065,140.101C120.936,142.151,121.806,141.173,122.677,143.177C123.547,145.18,124.418,152.122,125.288,152.122C126.159,152.122,127.029,139.629,127.9,133.806C128.771,127.983,129.641,117.185,130.512,117.185C131.382,117.185,132.253,125.131,133.123,127.312C133.994,129.493,134.864,130.583,135.735,130.583C136.605,130.583,137.476,95.463,138.346,95.463C139.217,95.463,140.087,130.583,140.958,130.583C141.828,130.583,142.699,123.988,143.569,123.988C144.44,123.988,145.31,146.205,146.181,146.205C147.051,146.205,147.922,136.955,148.792,133.806C149.663,130.657,150.533,127.312,151.404,127.312C152.274,127.312,153.145,129.477,154.015,133.806C154.886,138.135,155.756,157.858,156.627,157.858C157.497,157.858,158.368,117.185,159.238,117.185C160.109,117.185,160.979,122.98,161.85,127.312C162.721,131.644,163.591,143.177,164.462,143.177C165.332,143.177,166.203,126.115,167.073,120.613C167.944,115.112,168.814,110.167,169.685,110.167C170.555,110.167,171.426,157.858,172.296,157.858C173.167,157.858,174.037,127.312,174.908,127.312C175.778,127.312,176.649,142.26,177.519,146.205C178.39,150.149,179.26,152.122,180.131,152.122C181.001,152.122,181.872,127.312,182.742,127.312C183.613,127.312,184.483,149.186,185.354,149.186C186.224,149.186,187.095,137.452,187.965,133.806C188.836,130.16,189.706,130.662,190.577,127.312C191.447,123.962,192.318,113.703,193.188,113.703C194.059,113.703,194.929,133.806,195.8,133.806C196.671,133.806,197.541,127.312,198.412,127.312C199.282,127.312,200.153,136.706,201.023,143.177C201.894,149.647,202.764,166.135,203.635,166.135C204.505,166.135,205.376,130.583,206.246,130.583C207.117,130.583,207.987,157.858,208.858,157.858C209.728,157.858,210.599,133.806,211.469,133.806C212.34,133.806,213.21,155.012,214.081,155.012C214.951,155.012,215.822,148.69,216.692,146.205C217.563,143.72,218.433,143.804,219.304,140.101C220.174,136.399,221.045,128.388,221.915,123.988C222.786,119.589,223.656,113.703,224.527,113.703C225.397,113.703,226.268,130.575,227.138,136.978C228.009,143.381,228.879,152.122,229.75,152.122C230.621,152.122,231.491,145.924,232.362,140.101C233.232,134.279,234.103,117.185,234.973,117.185C235.844,117.185,236.714,179.105,237.585,179.105C238.455,179.105,239.326,176.551,240.196,171.444C241.067,166.337,241.937,140.101,242.808,140.101C243.678,140.101,244.549,141.662,245.419,143.177C246.29,144.691,247.16,149.186,248.031,149.186C248.901,149.186,249.772,143.177,250.642,143.177C251.513,143.177,252.383,163.42,253.254,163.42C254.124,163.42,254.995,142.092,255.865,133.806C256.736,125.52,257.606,113.703,258.477,113.703C259.347,113.703,260.218,127.312,261.088,127.312C261.959,127.312,262.829,126.204,263.7,123.988C264.571,121.772,265.441,113.703,266.312,113.703C267.182,113.703,268.053,113.703,268.923,113.703C269.794,113.703,270.664,114.864,271.535,117.185C272.405,119.506,273.276,149.186,274.146,149.186C275.017,149.186,275.887,149.186,276.758,149.186C277.628,149.186,278.499,125.265,279.369,113.703C280.24,102.142,281.11,79.818,281.981,79.818C282.851,79.818,283.722,110.566,284.592,120.613C285.463,130.661,286.333,140.101,287.204,140.101C288.074,140.101,288.945,127.808,289.815,123.988C290.686,120.169,291.556,117.185,292.427,117.185C293.297,117.185,294.168,133.797,295.038,140.101C295.909,146.406,296.779,155.012,297.65,155.012C298.521,155.012,299.391,140.101,300.262,140.101C301.132,140.101,302.003,152.122,302.873,152.122C303.744,152.122,304.614,127.312,305.485,127.312C306.355,127.312,307.226,149.186,308.096,149.186C308.967,149.186,309.837,130.583,310.708,130.583C311.578,130.583,312.449,142.615,313.319,146.205C314.19,149.794,315.06,152.122,315.931,152.122C316.801,152.122,317.672,133.806,318.542,133.806C319.413,133.806,320.283,140.101,321.154,140.101C322.024,140.101,322.895,117.185,323.765,117.185C324.636,117.185,325.506,141.389,326.377,152.122C327.247,162.854,328.118,181.58,328.988,181.58C329.859,181.58,330.729,177.064,331.6,174.037C332.471,171.011,333.341,166.591,334.212,163.42C335.082,160.249,335.953,159.419,336.823,155.012C337.694,150.605,338.564,136.978,339.435,136.978C340.305,136.978,341.176,174.037,342.046,174.037C342.917,174.037,343.787,144.298,344.658,140.101C345.528,135.904,346.399,135.392,347.269,133.806C348.14,132.22,349.01,130.583,349.881,130.583C350.751,130.583,351.622,132.907,352.492,136.978C353.363,141.05,354.233,155.012,355.104,155.012C355.974,155.012,356.845,146.205,357.715,146.205C358.586,146.205,359.456,149.186,360.327,149.186C361.197,149.186,362.068,127.312,362.938,127.312C363.809,127.312,364.679,156.341,365.55,163.42C366.421,170.498,367.291,174.037,368.162,174.037C369.032,174.037,369.903,162,370.773,157.858C371.644,153.716,372.514,153.195,373.385,149.186C374.255,145.177,375.126,133.806,375.996,133.806C376.867,133.806,377.737,135.416,378.608,136.978C379.478,138.54,380.349,143.177,381.219,143.177C382.09,143.177,382.96,120.613,383.831,120.613C384.701,120.613,385.572,136.978,386.442,136.978C387.313,136.978,388.183,106.577,389.054,106.577C389.924,106.577,390.795,152.122,391.665,152.122C392.536,152.122,393.406,148.999,394.277,143.177C395.147,137.354,396.018,117.185,396.888,117.185C397.759,117.185,398.629,140.101,399.5,140.101C400.371,140.101,401.241,130.583,402.112,130.583C402.982,130.583,403.853,176.591,404.723,176.591C405.594,176.591,406.464,149.431,407.335,140.101C408.205,130.772,409.076,120.613,409.946,120.613C410.817,120.613,411.687,122.846,412.558,127.312C413.428,131.778,414.299,152.122,415.169,152.122C416.04,152.122,416.91,152.122,417.781,152.122C418.651,152.122,419.522,160.66,420.392,160.66C421.263,160.66,422.133,148.224,423.004,146.205C423.874,144.186,424.745,143.177,425.615,143.177C426.486,143.177,427.356,168.811,428.227,168.811C429.097,168.811,429.968,149.186,430.838,149.186C431.709,149.186,432.579,168.811,433.45,168.811C434.321,168.811,435.191,166.094,436.062,160.66C436.932,155.227,437.803,133.806,438.673,133.806C439.544,133.806,440.414,143.177,441.285,143.177C442.155,143.177,443.026,123.988,443.896,123.988C444.767,123.988,445.637,125.096,446.508,127.312C447.378,129.528,448.249,169.716,449.119,171.444C449.99,173.173,450.86,174.037,451.731,174.037C452.601,174.037,453.472,167.366,454.342,160.66C455.213,153.955,456.083,135.954,456.954,133.806C457.824,131.658,458.695,130.583,459.565,130.583C460.436,130.583,461.306,131.658,462.177,133.806C463.047,135.954,463.918,146.644,464.788,155.012C465.659,163.381,466.529,184.017,467.4,184.017C468.271,184.017,469.141,153.744,470.012,143.177C470.882,132.609,471.753,120.613,472.623,120.613C473.494,120.613,474.364,160.66,475.235,160.66C476.105,160.66,476.976,140.101,477.846,140.101C478.717,140.101,479.587,143.177,480.458,143.177C481.328,143.177,482.199,116.061,483.069,113.703C483.94,111.346,484.81,110.167,485.681,110.167C486.551,110.167,487.422,127.312,488.292,127.312C489.163,127.312,490.033,123.988,490.904,123.988C491.774,123.988,492.645,123.988,493.515,123.988C494.386,123.988,495.256,157.858,496.127,157.858C496.997,157.858,497.868,146.205,498.738,146.205C499.609,146.205,500.479,152.122,501.35,152.122C502.221,152.122,503.091,117.185,503.962,117.185C504.832,117.185,505.703,134.279,506.573,140.101C507.444,145.924,508.314,152.122,509.185,152.122C510.055,152.122,510.926,130.583,511.796,130.583C512.667,130.583,513.537,131.658,514.408,133.806C515.278,135.954,516.149,157.858,517.019,157.858C517.89,157.858,518.76,140.101,519.631,140.101C520.501,140.101,521.372,171.444,522.242,171.444C523.113,171.444,523.983,163.484,524.854,155.012C525.724,146.54,526.595,120.613,527.465,120.613C528.336,120.613,529.206,143.177,530.077,143.177C530.947,143.177,531.818,137.004,532.688,133.806C533.559,130.608,534.429,123.988,535.3,123.988C536.171,123.988,537.041,152.122,537.912,152.122C538.782,152.122,539.653,143.177,540.523,143.177C541.394,143.177,542.264,172.099,543.135,181.58C544.005,191.06,544.876,200.06,545.746,200.06C546.617,200.06,547.487,194.712,548.358,184.017C549.228,173.322,550.099,113.703,550.969,113.703C551.84,113.703,552.71,117.132,553.581,123.988C554.451,130.845,555.322,155.012,556.192,155.012C557.063,155.012,557.933,120.613,558.804,120.613C559.674,120.613,560.545,171.444,561.415,171.444C562.286,171.444,563.156,152.122,564.027,152.122C564.897,152.122,565.768,179.105,566.638,179.105C567.509,179.105,568.379,178.267,569.25,176.591C570.121,174.915,570.991,102.929,571.862,102.929C572.732,102.929,573.603,179.955,574.473,181.58C575.344,183.205,576.214,184.017,577.085,184.017C577.955,184.017,578.826,155.497,579.696,140.101C580.567,124.706,581.437,91.643,582.308,91.643C583.178,91.643,584.049,144.217,584.919,146.205C585.79,148.192,586.66,149.186,587.531,149.186C588.401,149.186,589.272,135.022,590.142,127.312C591.013,119.602,591.883,102.929,592.754,102.929C593.624,102.929,594.495,147.072,595.365,157.858C596.236,168.644,597.106,174.037,597.977,174.037C598.847,174.037,599.718,169.596,600.588,163.42C601.459,157.243,602.329,136.978,603.2,136.978C604.071,136.978,604.941,158.296,605.812,166.135C606.682,173.975,607.553,184.017,608.423,184.017C609.294,184.017,610.164,172.942,611.035,166.135C611.905,159.329,612.776,143.177,613.646,143.177C614.517,143.177,615.387,163.42,616.258,163.42C617.128,163.42,617.999,136.978,618.869,136.978C619.74,136.978,620.61,149.186,621.481,149.186C622.351,149.186,623.222,149.186,624.092,149.186C624.963,149.186,625.833,171.444,626.704,171.444C627.574,171.444,628.445,157.858,629.315,157.858C630.186,157.858,631.056,160.66,631.927,160.66C632.797,160.66,633.668,159.726,634.538,157.858C635.409,155.99,636.279,102.929,637.15,102.929C638.021,102.929,638.891,157.858,639.762,157.858C640.632,157.858,641.503,157.858,642.373,157.858C643.244,157.858,644.114,149.186,644.985,149.186C645.855,149.186,646.726,160.66,647.596,160.66C648.467,160.66,649.337,155.842,650.208,146.205C651.078,136.568,651.949,83.821,652.819,83.821C653.69,83.821,654.56,204.333,655.431,204.333C656.301,204.333,657.172,199.038,658.042,195.652C658.913,192.266,659.783,186.775,660.654,184.017C661.524,181.259,662.395,182.38,663.265,179.105C664.136,175.83,665.006,99.226,665.877,99.226C666.747,99.226,667.618,195.652,668.488,195.652C669.359,195.652,670.229,161.682,671.1,157.858C671.971,154.034,672.841,155.946,673.712,152.122C674.582,148.297,675.453,124.257,676.323,117.185C677.194,110.113,678.064,106.577,678.935,106.577C679.805,106.577,680.676,141.919,681.546,157.858C682.417,173.797,683.287,202.212,684.158,202.212C685.028,202.212,685.899,194.545,686.769,191.106C687.64,187.667,688.51,184.857,689.381,181.58C690.251,178.303,691.122,171.444,691.992,171.444C692.863,171.444,693.733,191.106,694.604,191.106C695.474,191.106,696.345,176.591,697.215,176.591C698.086,176.591,698.956,202.212,699.827,202.212C700.697,202.212,701.568,157.858,702.438,157.858C703.309,157.858,704.179,212.491,705.05,212.491C705.921,212.491,706.791,179.858,707.662,168.811C708.532,157.763,709.403,146.205,710.273,146.205C711.144,146.205,712.014,147.199,712.885,149.186C713.755,151.174,714.626,163.42,715.496,163.42C716.367,163.42,717.237,128.524,718.108,123.988C718.978,119.453,719.849,117.185,720.719,117.185C721.59,117.185,722.46,138.046,723.331,146.205C724.201,154.363,725.072,166.135,725.942,166.135C726.813,166.135,727.683,127.312,728.554,127.312C729.424,127.312,730.295,163.42,731.165,163.42C732.036,163.42,732.906,127.312,733.777,127.312C734.647,127.312,735.518,174.037,736.388,174.037C737.259,174.037,738.129,171.424,739,168.811" style="opacity: 1;"></path><g class="recharts-layer" clip-path="url(#clipPath-recharts-line-39)"></g></g></svg>

1. p50
2. p90
3. p95
4. p99

Let’s look at the numbers to get a sense of the challenge: 100 billion vectors, 1024 dimensions per vector, 2 bytes per dimension (`f16`). **This is vector search over 200TiB of dense vector data**. We want to serve a high rate (> 1k QPS) of ANN queries over this entire dataset, each with a latency target of 200ms or less.

With a healthy dose of mechanical sympathy, let’s consider how our hardware will run this workload and where it will encounter bottlenecks. If one part of the system bottlenecks (disk, network, memory, or CPU), other parts of the system will go underutilized. The key to making the most of the available hardware is to push down bottlenecks and balance resource utilization.

turbopuffer’s [architecture](https://turbopuffer.com/docs/architecture) is simple and opinionated. This simplicity makes the exercise tractable. turbopuffer’s query tier is a stateless layer on top of object storage, consisting of a caching hierarchy and compute. That’s it.

```
╔════════════╗
      ║   client   ║░
      ╚════════════╝░
       ░░░░░║░░░░░░░░
            ▼
╔═ turbopuffer ════════════╗
║  ┏━━━━━━━━━━━━━━━━━━━━┓  ║░
║  ┃    Memory/SSD      ┃  ║░
║  ┃      Cache         ┃  ║░
║  ┗━━━━━━━━┳━━━━━━━━━━━┛  ║░
║           ▼              ║░
║  ┏━━━━━━━━━━━━━━━━━━━━┓  ║░
║  ┃    Object Storage  ┃  ║░
║  ┃      (S3)          ┃  ║░
║  ┗━━━━━━━━━━━━━━━━━━━━┛  ║░
╚══════════════════════════╝░
 ░░░░░░░░░░░░░░░░░░░░░░░░░░░░
```

### Identifying the bottleneck

When trying to process large amounts of data at high throughput, this system architecture could bottleneck in one of two ways. First, it could bottleneck on the CPU instructions needed to process the data (”compute-bound”). Second, it could bottleneck on the data path up the memory hierarchy feeding the CPU (”bandwidth-bound”).

We can borrow a strategy from the GPU community in order to estimate where it will bottleneck by classifying our workload’s [arithmetic intensity](https://en.wikipedia.org/wiki/Roofline_model#Arithmetic_intensity). Arithmetic intensity is the ratio of arithmetic operations to memory operations. It is often defined using GPU FLOPs and bytes transferred through GPU memory, but it is generalizable to other domains.

Different algorithms have different intensities. For example, a matrix-matrix multiplication is more intensive than a vector dot product. This is because in a matrix multiplication (`SGEMM`), each element in one matrix is multiplied against N elements (a full row or column) in the other matrix. In a vector dot product (`SDOT`), each element is multiplied only against one element from the other vector.

```
performance
(FLOPS/s)
▲
│                       ╱
│    memory bandwidth   
│     (bytes/second)  ╱
│                     arithmetic
│                   ╱ bandwidth
├ ─ ─ ─ ─ ─ ─ ─ ─ ██───┬──────
│          ridge  ╱    │
│          point ╱     │
│               ╱      │
│              ╱       │
│             ╱        │
│            ╱         │
│           ╱          │
│          ╱│          │
│         ╱            │ 
│        ╱  │memory    │compute
│       ╱    bound     │bound
│      ╱    │          │
│     ╱                │
│    ╱      │          │
│   ╱                  │
│  ╱        │          │
│ ╱                    │
└╳──────────┴──────────┴──▶
       arithmetic intensity
               (FLOPs/byte)
```

*adapted from [https://modal.com/gpu-glossary/perf/arithmetic-intensity](https://modal.com/gpu-glossary/perf/arithmetic-intensity)*

As a rule of thumb, a workload that has a small constant arithmetic intensity (e.g., SDOT) will be memory-bound. A workload that has a large constant or linear arithmetic intensity (e.g., SGEMM) will be compute-bound. The intuition is simple enough — if a byte pulled into a compute register is only used once or twice, more work goes into fetching the byte than is needed to operate on it. Meanwhile, if that byte is used many times, the memory fetch is amortized and the computation over it dominates.

If we imagine the kernel of a vector search, the system fetches each data vector and performs a distance calculation between it and a query vector. This distance function is essentially a vector dot product, multiplying the data and query value in each of the corresponding vector dimensions.

```
╭  ╮   ╭  ╮    
│d1│   │q1│ 
│d2│   │q2│ 
│d3│ • │q3│ = ∑ di • qi
│••│   │••│
│di│   │qi│
╰  ╯   ╰  ╯
```

Since each element in a data vector is used only once by the distance function, the arithmetic intensity of vector search is low. Most of the work goes into pulling many large data vectors into CPU registers. Recognizing this, we can predict that vector search will be **bandwidth-bound**, as is the case for many analytics and search systems.

Consequently, it doesn’t really matter how efficient the CPU instructions of our distance kernel are (within reason). If we are trying to maximize throughput (queries per second) on a machine, we are going to be limited by the number of data vectors we can run the kernel over each second.

With this insight in hand, our objective with ANN v3 is to **utilize cache space efficiently** and **balance bandwidth demands** to prevent the network, disk, or main memory from being a dominant bottleneck that limits the system’s ability to scale.

Let’s take a look at all of the places in turbopuffer’s memory hierarchy that might prevent a bandwidth-bound workload from scaling.

```
┌────────────┐
│CPU         │ Size: <1KB
│Registers   │ BW: >10 TB/s
├────────────┤
│L1/L2/L3    │ Size: KB-MB
│Cache       │ BW: 1-10s TB/s
├────────────┤
│Main Memory │ Size: GB-TB
│(DRAM)      │ BW: 100-500 GB/s
├────────────┤
│NVMe SSD    │ Size: 1-10s TBs
│(direct I/O)│ BW: 1-30 GB/s
├────────────┤
│Object      │ Size: PB-EB
│Storage     │ BW: 1-10 GB/s
└────────────┘
```

We observe four distinct boundaries where bandwidth may become the limiting factor.

- Object Storage (where data is durably stored) ↔ NVMe
- NVMe ↔ DRAM
- DRAM ↔ L3/L2/L1
- L3/L2/L1 ↔ CPU registers (where the compute actually happens)

Take note of the difference in bandwidth between levels of the hierarchy, but also differences in size. Higher tiers are orders of magnitude smaller, but can service many orders of magnitude higher rates of data loads.

To balance bandwidth across this hierarchy, ANN v3 combines two complementary techniques: **hierarchical clustering** and **binary quantization**.

Each exploits the same general strategy of “approximation and refinement”. ANN v3 works by first quickly answering: *roughly* where is the answer? and only then answering: out of that set, *exactly* what is the answer?

The first technique is *hierarchical clustering* in the index structure. Vector indexes in turbopuffer are based on [SPFresh](https://dl.acm.org/doi/10.1145/3600006.3613166), a centroid-based approximate nearest neighbor index that supports incremental updates. In a centroid-based index, vectors are grouped into clusters, each represented by a single "centroid" vector (typically the mean of all vectors in that cluster). At query time, we first compare the query to centroids to identify promising clusters, then search only within those clusters. We extended the SPTAG graph-based index described in the original SPFresh paper, nesting clusters hierarchically in a multi-dimensional tree structure.

While hierarchical clustering is not new to v3, it is a very important aspect of cold query performance in turbopuffer. When a namespace is *cold* (not cached on SSD), turbopuffer must fetch some or all of it from object storage. Instead of traversing a graph with sequential object storage round-trips to locate the relevant data clusters, the hierarchy bounds the number of round-trips to object storage to the height of the SPFresh tree. This places a bound on tail latency, even for the coldest query.

```
┌───────────────┐
      │ root centroid │
      │       c0      │
      └───────────────┘
        ╱     │     ╲
       ╱      │      ╲
┌────────┐┌────────┐┌────────┐
│centroid││centroid││centroid│
|   c1   ││   c2   ││   c3   │
└────────┘└────────┘└────────┘
      ╱│╲       ╱│╲       ╱│╲
     ╱ │ ╲     ╱ │ ╲     ╱ │ ╲
    ╱  │  ╲   ╱  │  ╲   ╱  │  ╲
┌──────┐ ┌──────┐ ┌──────┐ ┌────
│ data │ │ data │ │ data │ │     
|  v1  │ │  v2  │ │  v3  │ │ •••
└──────┘ └──────┘ └──────┘ └────
```

In the case of 100 billion vector search, we can’t afford to contend with the low bandwidth of object storage (<5 GB/s) for even a fraction of data vector reads, so we size deployments to store the entire tree on SSD. Yet even when cached, the tree structure complements the hardware.

Clustering interacts well with the memory hierarchy because it provides **spatial locality**. Vectors closer in space - those likely to be accessed together - are stored contiguously. This makes memory and disk accesses efficient. Specifically, it means that there is very little amplification when reading from lower levels of the hierarchy, even when those levels enforce a minimum read granularity (e.g., 4KiB from disk). Every byte fetched will be put to good use.

*Hierarchical* clustering, specifically, interacts well with the memory hierarchy because it provides **temporal locality**. Vector clusters in the upper levels of the tree are accessed frequently, so they will naturally remain resident in main memory. We use a 100x branching factor between levels of our tree to balance tree depth with cluster size. Each node in the tree has approximately 100 children, creating a wide, shallow tree structure. This branching factor roughly matches the size ratio between DRAM and SSD (10x - 50x), meaning that if we can fit all data vectors on SSD, we can fit all centroid vectors in DRAM.

All of this gets us back to the original purpose of the approximate nearest neighbor index: reducing the search space for each query. Approximate indexes are a compromise between performance and recall. For centroid-based indexes, we navigate this compromise by controlling how many clusters are scanned at each level of the tree (often called the "probes" or "beam width" parameter).

For vector search at this scale, we found experimentally that with good clustering, we needed to search about 500 data vector clusters (each 100 vectors large) on each machine to achieve our recall target. This equates to a bandwidth requirement of **100MB per level of the tree**:

```
100 vec   1024D   2 bytes
500 • ─────── • ───── • ─────── 
      cluster   vector  dim  

      
    = 100MB per level
```

We can use this to estimate throughput limits:

The derivation shows that with hierarchical clustering alone, we will end up disk-bound fetching data vector clusters and maxing out at around 100 queries per second. 100 qps over 100 billion vectors is admirable, but we can do better.

### Binary quantization to compress vector sizes

The second technique is *binary quantization* of data vectors. When vectors are inserted into turbopuffer, the system stores both the full-precision vector (`f32` or `f16` per dimension) and a transparently computed, quantized form of the vector (1-bit per dimension).

```
╭       ╮               ╭   ╮
│  0.94 │               │ 1 │
│ -0.01 │               │ 0 │
│  0.39 │               │ 1 │
│ -0.72 │ ────────────▶ │ 0 │
│  0.02 │    binary     │ 1 │
│ -0.85 │ quantization  │ 0 │
│ -0.18 │               │ 0 │
│  0.99 │               │ 1 │
│  0.45 │               │ 1 │
╰       ╯               ╰   ╯
```

The math works out as expected; **binary quantization provides a 16-32x compression for data vectors**. This allows these quantized vectors to be stored higher in the memory hierarchy and minimizes their memory bandwidth demands.

To avoid this compression leading to a loss of search quality, ANN v3 employs the [RaBitQ](https://dl.acm.org/doi/pdf/10.1145/3654970) quantization method. RaBitQ exploits the mathematical properties of high-dimensional space ([concentration of measure](https://en.wikipedia.org/wiki/Concentration_of_measure)) to compress aggressively while preserving high recall. Specifically, in high dimensions, vector components naturally become more uniformly distributed, which means quantization errors are spread evenly across all dimensions rather than concentrated in problematic directions. This uniform error distribution enables RaBitQ to provide tight theoretical error bounds alongside distance estimations made on quantized vectors.

For example, consider a data vector V <sub>d</sub> and query vector V <sub>q</sub>. A full-precision distance computation might compute the cosine distance between V <sub>d</sub> and V <sub>q</sub> as 0.75. Now consider their binary quantized forms, V <sub>d</sub> ' and V <sub>q</sub> '. Due to the loss of information from quantizing, RaBitQ cannot perfectly compute the true cosine distance by looking just at the quantized vectors. Instead, it will compute an estimated range like \[0.69, 0.83\].

Despite being imprecise, this confidence interval can be used to conclude that V <sub>d</sub> is closer to V <sub>q</sub> than some other vector V <sub>d2</sub> whose quantized distance estimate has a range \[0.87, 0.91\]. For other data vectors with overlapping distance estimate ranges (e.g., \[0.51, 0.77\]), RaBitQ makes no promises. Such vectors must be recompared using their full precision vectors.

During a vector search, turbopuffer first evaluates the search on quantized vectors, uses the error bounds to determine all vectors that could be in the *true* top-k, then fetches their corresponding full-precision vectors, and reranks over those to compute the final result. In practice, we find that less than 1% of data vectors in the narrowed search space need to be reranked to avoid an impact on recall.

## Putting it all together...

These two techniques compose, and their benefits multiply.

Upper levels of a quantized ANN tree are small but frequently accessed. As a result, they naturally remain resident all the way up in the L3 CPU cache. We can write out the math to demonstrate this to ourselves. With a branching factor of 100, each level L in the tree contains `100^L * 1024/8` bytes of quantized vector data (1 bit per dimension). With a 504MiB shared L3 cache, we can fit all three upper levels of the tree in L3 cache, the largest requiring `100^3 * 128 = 128 MiB` of cache space.

The lowest level of the quantized ANN tree is stored in DRAM, as was the case before. However, because these vectors are compressed, they require less memory bandwidth to access.

Meanwhile, the full-precision vectors remain on local SSD. However, only a small fraction is fetched during the reranking phase, through a highly concurrent [scatter-gather](https://en.wikipedia.org/wiki/Gather/scatter_\(vector_addressing\)). This access pattern is ideal for modern NVMe drives, which have random read latencies around 50-100 microseconds and excel at handling many parallel I/O operations simultaneously, allowing us to access the full bandwidth of the disks.

We can again estimate throughput limits. Remember that quantized vectors are 16x smaller than unquantized `f16` vectors, equating to a bandwidth requirement of `500 x 100 x 1024 x 2 / 16 = 6MB` per level of the tree.

The changes here demonstrate a remarkable dynamic in the memory hierarchy. Data compression both reduces bandwidth requirements and allows data to remain resident in higher bandwidth tiers at the same time, leading to a multiplicative effect. Whereas before the theoretical throughput limit was 100 qps, quantization unlocks a theoretical limit of 10,000 qps!

## ...to end up compute-bound...

By combining hierarchical clustering with binary quantization, ANN v3 makes efficient use of cache space and balances bandwidth demands across the tiers of the memory hierarchy.

However, if we run a production load against it, we notice something interesting. Instead of hitting the theoretical 10,000 qps, the system ends up saturated around 1,000 qps, 10% of where we’d like to be.

What is happening here? Why are we no longer limited by disk bandwidth, and instead limited somewhere else?

Returning to our framework for arithmetic intensity, we discover what changed. When we added in binary quantization, intensity shot up. With `f16` vector elements, every two bytes fetched from memory were used for a single logical operation. With binary quantized elements, however, every two bytes fetched are used for **sixteen** logical operations (one per bit). In fact, the RaBitQ algorithm reuses each bit four times when computing distance estimates (section 3.3.2 of the [paper](https://arxiv.org/pdf/2405.12497)), leading to 64x higher arithmetic intensity.

This large constant arithmetic intensity is enough to tip the scale towards the system being compute-bound. Each CPU core in our system cannot keep up with the rate of highly compressed vector data being fed to it, bottlenecking throughput.

Optimizing a compute-bound system is a different game, requiring an obsessive focus on:

1. doing the same work with fewer instructions
2. keeping the CPU pipelines fed by avoiding stalls and branch mispredictions

As an example, we were recently surprised to find that [AVX2](https://en.wikipedia.org/wiki/Advanced_Vector_Extensions) (256-bit x86 SIMD) does not have an accelerated [popcount instruction](https://en.wikichip.org/wiki/population_count). Counting the number of bits set in a series of bytes is an important operation for RaBitQ, so making this operation fast was essential. We switched a core distance estimation kernel over to [AVX-512](https://en.wikipedia.org/wiki/AVX-512) to gain access to its `VPOPCNTDQ` instruction. This instruction is capable of counting the bits set to one across a 512-bit register in only 3 cpu cycles of latency. Better yet, it can be pipelined for a throughput of 1 instruction per cycle.

Making the switch improved the performance of the kernel in microbenchmarks by 30% and improved end-to-end production throughput by about 5%. When microbenchmarks translate to end-to-end performance gains, you have correctly identified the system’s bottleneck.

A more general discussion of optimizing a compute-bound system is a deeper topic than we have room for in this post, but it remains a focus of our work to this day as we continue to optimize ANN v3 for higher throughput.

## ...in a distributed cluster

Careful readers may have noticed one inconsistency in the description of ANN v3 so far. I mentioned up top that our goal was to handle vector search over 200 TiB of dense vector data. We also discussed that for this workload shape, all of this data should be cached on SSD to avoid the limited bandwidth and high latency of object storage. And yet, NVMe SSDs only get so large...

This is where distribution comes in. Modern clouds provide storage-dense VMs with fast locally attached NVMe drives (e.g., GCP's `z3`, AWS’s `I7i`, Azure’s `Lsv4`). These drives are large (10-40TiB) but not 200TiB large. To achieve the desired aggregate SSD capacity, we use a cluster of storage-optimized machines, each storing a subset of the index.

At this scale, simple random sharding works well. During ingestion, each vector is randomly assigned to one of the shards of the index. An ANN search query is broadcast to all shards, and the global top-k is stitched together from the sub-results.

This technique can scale to arbitrarily large indexes, but its cost scales linearly with the number of machines in the cluster. This is why it is crucial to maximize the efficiency of a single machine before turning to distribution. Moving in the other direction leads to an unnecessarily expensive system.

## Conclusion

When performance at scale becomes cost-efficient, it stops being a benchmarking exercise and becomes a building block.

The ANN v3 architecture pushes turbopuffer to 100 billion-vector scale at thousands of QPS, while holding p99 latency at 200ms. More importantly, it does this while keeping costs low enough to run continuously in production. It achieves this through hierarchical clustering that matches the memory hierarchy, binary quantization that compresses vectors by 16-32x with reranking to maintain recall, and distribution across storage-dense machines - all working together to maximize hardware utilization and minimize bottlenecks.

turbopuffer customers can now use ANN v3 with the sharding and pinning technique by splitting their largest indexes into 4 TiB namespaces and randomly assigning vectors across them. Then, [contact us](https://turbopuffer.com/contact/support) to pin each shard to its own SSD (this option will soon be available directly in the dashboard). We're also working on making the sharding fully transparent in the future.

## turbopuffer

We host 2.5T+ documents, handle writes at10M+ writes/s, and serve 10k+ queries/s. We are ready for far more. We hope you'll trust us with your queries.

[Get started](https://turbopuffer.com/join)